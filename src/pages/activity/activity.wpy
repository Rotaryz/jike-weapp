<template>
  <web-view src="{{webviewUrl}}"></web-view>
</template>

<script>
  import wepy from 'wepy'
  import users from 'common/mixins/users'
  import base from 'common/mixins/base'
  import URIS from 'common/js/config'

  export default class Activity extends wepy.page {
    mixins = [users, base]
    data = {
      webviewUrl: '',
      token: '',
      merchantId: ''
    }

    onShareAppMessage(res) {
      const user = this.$parent.globalData.user
      let title = ''
      if (this.type === 'wheel') {
        title = `大转盘`
      } else if (this.type === 'sign') {
        title = '签到红包'
      } else if (this.type === 'y') {
        title = '异业联盟活动'
      }
      return {
        title: user.nickName + title,
        path: `/pages/activity/activity?type=${this.type}&merchantId=${this.merchantId}`,
        success: async () => {
          // 转发成功
        },
        fail: (res) => {
          // 转发失败
          console.log(res)
        }
      }
    }

    async onLoad(option) {
      this.type = option.type
      if (option.m) {
        wepy.setStorageSync('merchantId', option.m)
      }
      this.loaded()
      const token = wepy.getStorageSync('token')
      this.merchantId = wepy.getStorageSync('merchantId')
      if (this.type === 'wheel') {
        this.webviewUrl = `${URIS.webview}/index.html?token=${token}&merchantId=${this.merchantId}#/wheel`
      } else if (this.type === 'sign') {
        this.webviewUrl = `${URIS.webview}/index.html?token=${token}&merchantId=${this.merchantId}#/registration`
      } else if (this.type === 'y') {
        wepy.setStorageSync('a', option.a)
        wepy.setStorageSync('e', option.e)
        this.webviewUrl = `${URIS.webview}/index.html#/activity?a=${option.a}&e=${option.e}&m=${this.merchantId}`
      }
      this.$apply()
    }
  }
</script>

<style lang="stylus">

</style>
